<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Canvas Viewer</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

#toolbar {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 10;
    background: white;
    padding: 5px;
    border-radius: 4px;
}

#canvas {
    display: block;
    position: absolute;
    top: 50px; /* відступ під кнопкою */
    left: 0;
}
</style>
</head>

<body>

<div id="toolbar">
    <input type="file" id="fileInput" accept="image/*,.pdf">
</div>

<canvas id="canvas"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const fileInput = document.getElementById("fileInput");

const topOffset = 50;
const bottomOffset = 30;

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight - topOffset - bottomOffset;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

/* ===== DRAW BORDER ===== */
function drawBorder(x, y, w, h) {
    ctx.save();
    ctx.strokeStyle = "red";
    ctx.lineWidth = 2;
    ctx.strokeRect(x, y, w, h);
    ctx.restore();
}

/* ===== IMAGE ===== */
function loadImage(file) {
    const img = new Image();
    img.onload = () => {
        resizeCanvas();
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const scale = Math.min(
            canvas.width / img.width,
            canvas.height / img.height
        );

        const w = img.width * scale;
        const h = img.height * scale;
        const x = (canvas.width - w) / 2;
        const y = (canvas.height - h) / 2;

        ctx.drawImage(img, x, y, w, h);
        drawBorder(x, y, w, h);
    };
    img.src = URL.createObjectURL(file);
}

/* ===== PDF ===== */
async function loadPDF(file) {
    const data = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data }).promise;
    const page = await pdf.getPage(1);

    const viewport = page.getViewport({ scale: 1 });

    const scale = Math.min(
        canvas.width / viewport.width,
        canvas.height / viewport.height
    );

    const scaledViewport = page.getViewport({ scale });

    canvas.width = window.innerWidth; // залишаємо всю ширину для центрирування
    canvas.height = window.innerHeight - topOffset - bottomOffset;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // центрування PDF на canvas
    const x = (canvas.width - scaledViewport.width) / 2;
    const y = (canvas.height - scaledViewport.height) / 2;

    await page.render({
        canvasContext: ctx,
        viewport: scaledViewport,
        transform: [1, 0, 0, 1, x, y] // зсув для центрирування
    }).promise;

    drawBorder(x, y, scaledViewport.width, scaledViewport.height);
}

/* ===== FILE HANDLING ===== */
function handleFile(file) {
    if (!file) return;

    if (file.type === "application/pdf") {
        loadPDF(file);
    } else if (file.type.startsWith("image/")) {
        loadImage(file);
    }
}

/* ===== INPUT ===== */
fileInput.addEventListener("change", e => handleFile(e.target.files[0]));

/* ===== DRAG & DROP ===== */
window.addEventListener("dragenter", e => e.preventDefault());
window.addEventListener("dragover", e => e.preventDefault());
window.addEventListener("drop", e => {
    e.preventDefault();
    handleFile(e.dataTransfer.files[0]);
});
</script>

</body>
</html>
